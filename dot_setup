#!/usr/bin/env perl

use strict;
use warnings;

my $home = $ENV{HOME};
my $dir = $0;
$dir =~ s{^\./}{$ENV{PWD}/};
$dir =~ s{/[^/]+$}{}; # Remove filename
$dir =~ s{^$home/?}{}; # Convert to being relative to home

foreach my $f (@ARGV) {
	chomp $f;
	next if $f =~ /dot_setup/;

	if( $f =~ /USUAL/ ) {
		open USUAL, '<', "$dir/$f" or die $!;
		push @ARGV, <USUAL>;
		close USUAL;
		next;
	}

	my $dest = "$ENV{HOME}/.$f";

	my $status = -e $dest ? '.' : '+';
	print "$status $f\n";

	next unless $status eq '+';
	symlink "$dir/$f" => $dest or die;
}
