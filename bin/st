#!/bin/bash

# Helper for attaching to a remote tmux session

st () {
  if [[ -n "$TMUX" ]]; then
    echo 'Already in a tmux session (unset $TMUX to nest)' >&2
    return 1
  fi

  if [[ -z "$1"  ]] ; then
    echo "Usage: $0 <HOST> [<SESSION>] [<COMMAND> ...OPTIONS]" >&2
    return 1
  fi

  local host=$1
  shift

  local session=0 # default
  if [ -n "${1:-}" ] ; then
    session=${1}
    shift
  fi

  ssh -t "$host" tmux new -ADs "$session" "$@"
}

st "$@"
