#!/usr/bin/ruby1.8 -w

#$stderr.reopen '/tmp/expand_muttrc.debug', 'w'
#$stderr.puts "I have PID #{Process.pid}"
#$stderr.puts "My parent is #{ Process.ppid }"

Dir.chdir( File.dirname($0) )

require 'eruby'
require 'muttrc'

$compiler = ERuby::Compiler.new

def mutt_include( fname )
  #$stderr.puts "Compiling #{fname}"
  code = File.open( fname ){ |fh| $compiler.compile_file( fh ) }
  #$stderr.puts "Eval'ing #{fname}"
  eval( code, nil, fname )
end

ARGV.each do |file|
  mutt_include file
end
